import { __decorate, __param } from "tslib";
/*
 * Copyright (c) 2016-2020 VMware, Inc. All Rights Reserved.
 * This software is released under MIT license.
 * The full license information can be found in LICENSE in the root directory of this project.
 */
import { ChangeDetectorRef, ElementRef, Component, EventEmitter, Input, Optional, Output, AfterViewInit, ContentChildren, QueryList, OnInit, OnDestroy, } from '@angular/core';
// providers
import { AlertIconAndTypesService } from './providers/icon-and-types.service';
import { MultiAlertService } from './providers/multi-alert.service';
import { isBooleanAttributeSet } from '../../utils/component/is-boolean-attribute-set';
import { ClrCommonStringsService } from '../../utils/i18n/common-strings.service';
import { ClrAriaLiveService, ClrAriaLivePoliteness } from '../../utils/a11y/aria-live.service';
import { ClrAlertText } from './alert-text';
let ClrAlert = class ClrAlert {
    constructor(iconService, cdr, multiAlertService, commonStrings, ariaLiveService) {
        this.iconService = iconService;
        this.cdr = cdr;
        this.multiAlertService = multiAlertService;
        this.commonStrings = commonStrings;
        this.ariaLiveService = ariaLiveService;
        this.subscriptions = [];
        this.isSmall = false;
        this.closable = true;
        this.isAppLevel = false;
        // Aria
        this.clrCloseButtonAriaLabel = this.commonStrings.keys.alertCloseButtonAriaLabel;
        this._closed = false;
        this._closedChanged = new EventEmitter(false);
        /**
         * clrPolite is not used in the code. Is here just to provide
         * code complition and also mark component what type AriaLive
         * will be used.
         */
        /** @deprecated since 3.0, remove in 4.0 */
        this.polite = true;
    }
    ngOnInit() {
        if (this.multiAlertService) {
            this.subscriptions.push(this.multiAlertService.changes.subscribe(() => {
                this.hidden = this.multiAlertService.currentAlert !== this;
            }));
        }
    }
    ngOnDestroy() {
        this.subscriptions.forEach(sub => sub.unsubscribe());
    }
    ngAfterViewInit() {
        // Announce the first time the alert is render if it is not hidden
        this.announceAriaLiveMessage();
    }
    set alertType(val) {
        this.iconService.alertType = val;
    }
    get alertType() {
        return this.iconService.alertType;
    }
    /**
     * There is an order on how the attributes will take effect.
     * Assertive, Off, Polite.
     *
     * Polite is default if non is passed.
     *
     * In the case of setting all of them to true. Assertive will be used.
     *
     */
    get ariaLive() {
        if (isBooleanAttributeSet(this.assertive)) {
            return ClrAriaLivePoliteness.assertive;
        }
        if (isBooleanAttributeSet(this.off)) {
            return ClrAriaLivePoliteness.off;
        }
        return ClrAriaLivePoliteness.polite;
    }
    set alertIconShape(value) {
        this.iconService.alertIconShape = value;
    }
    get alertClass() {
        return this.iconService.iconInfoFromType(this.iconService.alertType).cssClass;
    }
    /**
     * This handle the find what content to be annonced withing the aria-live container
     * alerts that are hidden will be ignored.
     *
     * @remark
     * We depend on the ClrAlertText Directive to find and parse the alert messages.
     * Also this require the HTML markup for the alert to be
     * ```html
     * <div class="alert" role="alert">
     *    <div class="alert-items">
     *        <div class="alert-item static">
     *            <span class="alert-text">
     *                 ...
     *            </span>
     *        </div>
     *    </div>
     * </div>
     * ```
     */
    announceAriaLiveMessage() {
        if (!this.hidden && this.alertTexts.length) {
            const message = this.alertTexts.map(alertText => alertText.nativeElement.textContent).join(' ');
            // Don't call announce when there is nothing to say
            if (message) {
                this.ariaLiveService.announce(message, this.ariaLive);
            }
        }
    }
    set hidden(value) {
        if (value !== this._hidden) {
            this._hidden = value;
            this.cdr.detectChanges();
        }
    }
    get hidden() {
        return this._hidden;
    }
    close() {
        if (!this.closable) {
            return;
        }
        this._closed = true;
        if (this.multiAlertService) {
            this.multiAlertService.close();
        }
        this._closedChanged.emit(true);
    }
    open() {
        this._closed = false;
        this._closedChanged.emit(false);
    }
};
ClrAlert.ctorParameters = () => [
    { type: AlertIconAndTypesService },
    { type: ChangeDetectorRef },
    { type: MultiAlertService, decorators: [{ type: Optional }] },
    { type: ClrCommonStringsService },
    { type: ClrAriaLiveService }
];
__decorate([
    Input('clrAlertSizeSmall')
], ClrAlert.prototype, "isSmall", void 0);
__decorate([
    Input('clrAlertClosable')
], ClrAlert.prototype, "closable", void 0);
__decorate([
    Input('clrAlertAppLevel')
], ClrAlert.prototype, "isAppLevel", void 0);
__decorate([
    Input()
], ClrAlert.prototype, "clrCloseButtonAriaLabel", void 0);
__decorate([
    Input('clrAlertClosed')
], ClrAlert.prototype, "_closed", void 0);
__decorate([
    Output('clrAlertClosedChange')
], ClrAlert.prototype, "_closedChanged", void 0);
__decorate([
    Input('clrAlertType')
], ClrAlert.prototype, "alertType", null);
__decorate([
    Input('clrPolite')
], ClrAlert.prototype, "polite", void 0);
__decorate([
    Input('clrAssertive')
], ClrAlert.prototype, "assertive", void 0);
__decorate([
    Input('clrOff')
], ClrAlert.prototype, "off", void 0);
__decorate([
    Input('clrAlertIcon')
], ClrAlert.prototype, "alertIconShape", null);
__decorate([
    ContentChildren(ClrAlertText, { descendants: true, read: ElementRef })
], ClrAlert.prototype, "alertTexts", void 0);
ClrAlert = __decorate([
    Component({
        selector: 'clr-alert',
        providers: [AlertIconAndTypesService, ClrAriaLiveService],
        template: "<!--\n  ~ Copyright (c) 2016-2020 VMware, Inc. All Rights Reserved.\n  ~ This software is released under MIT license.\n  ~ The full license information can be found in LICENSE in the root directory of this project.\n  -->\n\n<div\n    *ngIf=\"!_closed\"\n    class=\"alert\"\n    [ngClass]=\"alertClass\"\n    [class.alert-hidden]=\"hidden\"\n    [class.alert-sm]=\"isSmall\"\n    [class.alert-app-level]=\"isAppLevel\">\n    <div class=\"alert-items\">\n        <ng-content></ng-content>\n    </div>\n    <button\n        type=\"button\"\n        class=\"close\"\n        *ngIf=\"closable\"\n        (click)=\"close()\"\n        [attr.aria-label]=\"clrCloseButtonAriaLabel\"\n        >\n        <clr-icon shape=\"close\"></clr-icon>\n    </button>\n</div>\n",
        styles: [':host { display: block; }']
    }),
    __param(2, Optional())
], ClrAlert);
export { ClrAlert };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWxlcnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AY2xyL2FuZ3VsYXIvIiwic291cmNlcyI6WyJlbXBoYXNpcy9hbGVydC9hbGVydC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRztBQUNILE9BQU8sRUFDTCxpQkFBaUIsRUFDakIsVUFBVSxFQUNWLFNBQVMsRUFDVCxZQUFZLEVBQ1osS0FBSyxFQUNMLFFBQVEsRUFDUixNQUFNLEVBQ04sYUFBYSxFQUNiLGVBQWUsRUFDZixTQUFTLEVBQ1QsTUFBTSxFQUNOLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUV2QixZQUFZO0FBQ1osT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDOUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDcEUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sZ0RBQWdELENBQUM7QUFDdkYsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFDbEYsT0FBTyxFQUFFLGtCQUFrQixFQUFFLHFCQUFxQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDL0YsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGNBQWMsQ0FBQztBQVM1QyxJQUFhLFFBQVEsR0FBckIsTUFBYSxRQUFRO0lBR25CLFlBQ1UsV0FBcUMsRUFDckMsR0FBc0IsRUFDVixpQkFBb0MsRUFDaEQsYUFBc0MsRUFDdEMsZUFBbUM7UUFKbkMsZ0JBQVcsR0FBWCxXQUFXLENBQTBCO1FBQ3JDLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBQ1Ysc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUNoRCxrQkFBYSxHQUFiLGFBQWEsQ0FBeUI7UUFDdEMsb0JBQWUsR0FBZixlQUFlLENBQW9CO1FBUHJDLGtCQUFhLEdBQW1CLEVBQUUsQ0FBQztRQTZCZixZQUFPLEdBQVksS0FBSyxDQUFDO1FBQzFCLGFBQVEsR0FBWSxJQUFJLENBQUM7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LEVBQUUsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsQ0FBQzs0Q0FDckM7QUF6RnZCLFFBQVE7SUFOcEIsU0FBUyxDQUFDO1FBQ1QsUUFBUSxFQUFFLFdBQVc7UUFDckIsU0FBUyxFQUFFLENBQUMsd0JBQXdCLEVBQUUsa0JBQWtCLENBQUM7UUFDekQsa3dCQUEyQjtpQkFDbEIsMkJBQTJCO0tBQ3JDLENBQUM7SUFPRyxXQUFBLFFBQVEsRUFBRSxDQUFBO0dBTkYsUUFBUSxDQW1KcEI7U0FuSlksUUFBUSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTYtMjAyMCBWTXdhcmUsIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIFRoaXMgc29mdHdhcmUgaXMgcmVsZWFzZWQgdW5kZXIgTUlUIGxpY2Vuc2UuXG4gKiBUaGUgZnVsbCBsaWNlbnNlIGluZm9ybWF0aW9uIGNhbiBiZSBmb3VuZCBpbiBMSUNFTlNFIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHByb2plY3QuXG4gKi9cbmltcG9ydCB7XG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBFbGVtZW50UmVmLFxuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9wdGlvbmFsLFxuICBPdXRwdXQsXG4gIEFmdGVyVmlld0luaXQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgUXVlcnlMaXN0LFxuICBPbkluaXQsXG4gIE9uRGVzdHJveSxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbi8vIHByb3ZpZGVyc1xuaW1wb3J0IHsgQWxlcnRJY29uQW5kVHlwZXNTZXJ2aWNlIH0gZnJvbSAnLi9wcm92aWRlcnMvaWNvbi1hbmQtdHlwZXMuc2VydmljZSc7XG5pbXBvcnQgeyBNdWx0aUFsZXJ0U2VydmljZSB9IGZyb20gJy4vcHJvdmlkZXJzL211bHRpLWFsZXJ0LnNlcnZpY2UnO1xuaW1wb3J0IHsgaXNCb29sZWFuQXR0cmlidXRlU2V0IH0gZnJvbSAnLi4vLi4vdXRpbHMvY29tcG9uZW50L2lzLWJvb2xlYW4tYXR0cmlidXRlLXNldCc7XG5pbXBvcnQgeyBDbHJDb21tb25TdHJpbmdzU2VydmljZSB9IGZyb20gJy4uLy4uL3V0aWxzL2kxOG4vY29tbW9uLXN0cmluZ3Muc2VydmljZSc7XG5pbXBvcnQgeyBDbHJBcmlhTGl2ZVNlcnZpY2UsIENsckFyaWFMaXZlUG9saXRlbmVzcyB9IGZyb20gJy4uLy4uL3V0aWxzL2ExMXkvYXJpYS1saXZlLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ2xyQWxlcnRUZXh0IH0gZnJvbSAnLi9hbGVydC10ZXh0JztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjbHItYWxlcnQnLFxuICBwcm92aWRlcnM6IFtBbGVydEljb25BbmRUeXBlc1NlcnZpY2UsIENsckFyaWFMaXZlU2VydmljZV0sXG4gIHRlbXBsYXRlVXJsOiAnLi9hbGVydC5odG1sJyxcbiAgc3R5bGVzOiBbJzpob3N0IHsgZGlzcGxheTogYmxvY2s7IH0nXSxcbn0pXG5leHBvcnQgY2xhc3MgQ2xyQWxlcnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCB7XG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uczogU3Vic2NyaXB0aW9uW10gPSBbXTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGljb25TZXJ2aWNlOiBBbGVydEljb25BbmRUeXBlc1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgbXVsdGlBbGVydFNlcnZpY2U6IE11bHRpQWxlcnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgY29tbW9uU3RyaW5nczogQ2xyQ29tbW9uU3RyaW5nc1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBhcmlhTGl2ZVNlcnZpY2U6IENsckFyaWFMaXZlU2VydmljZVxuICApIHt9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgaWYgKHRoaXMubXVsdGlBbGVydFNlcnZpY2UpIHtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKFxuICAgICAgICB0aGlzLm11bHRpQWxlcnRTZXJ2aWNlLmNoYW5nZXMuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICB0aGlzLmhpZGRlbiA9IHRoaXMubXVsdGlBbGVydFNlcnZpY2UuY3VycmVudEFsZXJ0ICE9PSB0aGlzO1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZm9yRWFjaChzdWIgPT4gc3ViLnVuc3Vic2NyaWJlKCkpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIC8vIEFubm91bmNlIHRoZSBmaXJzdCB0aW1lIHRoZSBhbGVydCBpcyByZW5kZXIgaWYgaXQgaXMgbm90IGhpZGRlblxuICAgIHRoaXMuYW5ub3VuY2VBcmlhTGl2ZU1lc3NhZ2UoKTtcbiAgfVxuXG4gIEBJbnB1dCgnY2xyQWxlcnRTaXplU21hbGwnKSBpc1NtYWxsOiBib29sZWFuID0gZmFsc2U7XG4gIEBJbnB1dCgnY2xyQWxlcnRDbG9zYWJsZScpIGNsb3NhYmxlOiBib29sZWFuID0gdHJ1ZTtcbiAgQElucHV0KCdjbHJBbGVydEFwcExldmVsJykgaXNBcHBMZXZlbDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8vIEFyaWFcbiAgQElucHV0KCkgY2xyQ2xvc2VCdXR0b25BcmlhTGFiZWw6IHN0cmluZyA9IHRoaXMuY29tbW9uU3RyaW5ncy5rZXlzLmFsZXJ0Q2xvc2VCdXR0b25BcmlhTGFiZWw7XG5cbiAgQElucHV0KCdjbHJBbGVydENsb3NlZCcpIF9jbG9zZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgQE91dHB1dCgnY2xyQWxlcnRDbG9zZWRDaGFuZ2UnKSBfY2xvc2VkQ2hhbmdlZDogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPihmYWxzZSk7XG5cbiAgQElucHV0KCdjbHJBbGVydFR5cGUnKVxuICBzZXQgYWxlcnRUeXBlKHZhbDogc3RyaW5nKSB7XG4gICAgdGhpcy5pY29uU2VydmljZS5hbGVydFR5cGUgPSB2YWw7XG4gIH1cblxuICBnZXQgYWxlcnRUeXBlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuaWNvblNlcnZpY2UuYWxlcnRUeXBlO1xuICB9XG5cbiAgLyoqXG4gICAqIGNsclBvbGl0ZSBpcyBub3QgdXNlZCBpbiB0aGUgY29kZS4gSXMgaGVyZSBqdXN0IHRvIHByb3ZpZGVcbiAgICogY29kZSBjb21wbGl0aW9uIGFuZCBhbHNvIG1hcmsgY29tcG9uZW50IHdoYXQgdHlwZSBBcmlhTGl2ZVxuICAgKiB3aWxsIGJlIHVzZWQuXG4gICAqL1xuICAvKiogQGRlcHJlY2F0ZWQgc2luY2UgMy4wLCByZW1vdmUgaW4gNC4wICovXG4gIEBJbnB1dCgnY2xyUG9saXRlJykgcG9saXRlOiBib29sZWFuID0gdHJ1ZTtcbiAgLyoqIEBkZXByZWNhdGVkIHNpbmNlIDMuMCwgcmVtb3ZlIGluIDQuMCAqL1xuICBASW5wdXQoJ2NsckFzc2VydGl2ZScpIGFzc2VydGl2ZTogYm9vbGVhbjtcbiAgLyoqIEBkZXByZWNhdGVkIHNpbmNlIDMuMCwgcmVtb3ZlIGluIDQuMCAqL1xuICBASW5wdXQoJ2Nsck9mZicpIG9mZjogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFRoZXJlIGlzIGFuIG9yZGVyIG9uIGhvdyB0aGUgYXR0cmlidXRlcyB3aWxsIHRha2UgZWZmZWN0LlxuICAgKiBBc3NlcnRpdmUsIE9mZiwgUG9saXRlLlxuICAgKlxuICAgKiBQb2xpdGUgaXMgZGVmYXVsdCBpZiBub24gaXMgcGFzc2VkLlxuICAgKlxuICAgKiBJbiB0aGUgY2FzZSBvZiBzZXR0aW5nIGFsbCBvZiB0aGVtIHRvIHRydWUuIEFzc2VydGl2ZSB3aWxsIGJlIHVzZWQuXG4gICAqXG4gICAqL1xuICBnZXQgYXJpYUxpdmUoKTogQ2xyQXJpYUxpdmVQb2xpdGVuZXNzIHtcbiAgICBpZiAoaXNCb29sZWFuQXR0cmlidXRlU2V0KHRoaXMuYXNzZXJ0aXZlKSkge1xuICAgICAgcmV0dXJuIENsckFyaWFMaXZlUG9saXRlbmVzcy5hc3NlcnRpdmU7XG4gICAgfVxuICAgIGlmIChpc0Jvb2xlYW5BdHRyaWJ1dGVTZXQodGhpcy5vZmYpKSB7XG4gICAgICByZXR1cm4gQ2xyQXJpYUxpdmVQb2xpdGVuZXNzLm9mZjtcbiAgICB9XG4gICAgcmV0dXJuIENsckFyaWFMaXZlUG9saXRlbmVzcy5wb2xpdGU7XG4gIH1cblxuICBASW5wdXQoJ2NsckFsZXJ0SWNvbicpXG4gIHNldCBhbGVydEljb25TaGFwZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5pY29uU2VydmljZS5hbGVydEljb25TaGFwZSA9IHZhbHVlO1xuICB9XG5cbiAgZ2V0IGFsZXJ0Q2xhc3MoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pY29uU2VydmljZS5pY29uSW5mb0Zyb21UeXBlKHRoaXMuaWNvblNlcnZpY2UuYWxlcnRUeXBlKS5jc3NDbGFzcztcbiAgfVxuXG4gIEBDb250ZW50Q2hpbGRyZW4oQ2xyQWxlcnRUZXh0LCB7IGRlc2NlbmRhbnRzOiB0cnVlLCByZWFkOiBFbGVtZW50UmVmIH0pXG4gIGFsZXJ0VGV4dHM6IFF1ZXJ5TGlzdDxFbGVtZW50UmVmPjtcbiAgLyoqXG4gICAqIFRoaXMgaGFuZGxlIHRoZSBmaW5kIHdoYXQgY29udGVudCB0byBiZSBhbm5vbmNlZCB3aXRoaW5nIHRoZSBhcmlhLWxpdmUgY29udGFpbmVyXG4gICAqIGFsZXJ0cyB0aGF0IGFyZSBoaWRkZW4gd2lsbCBiZSBpZ25vcmVkLlxuICAgKlxuICAgKiBAcmVtYXJrXG4gICAqIFdlIGRlcGVuZCBvbiB0aGUgQ2xyQWxlcnRUZXh0IERpcmVjdGl2ZSB0byBmaW5kIGFuZCBwYXJzZSB0aGUgYWxlcnQgbWVzc2FnZXMuXG4gICAqIEFsc28gdGhpcyByZXF1aXJlIHRoZSBIVE1MIG1hcmt1cCBmb3IgdGhlIGFsZXJ0IHRvIGJlXG4gICAqIGBgYGh0bWxcbiAgICogPGRpdiBjbGFzcz1cImFsZXJ0XCIgcm9sZT1cImFsZXJ0XCI+XG4gICAqICAgIDxkaXYgY2xhc3M9XCJhbGVydC1pdGVtc1wiPlxuICAgKiAgICAgICAgPGRpdiBjbGFzcz1cImFsZXJ0LWl0ZW0gc3RhdGljXCI+XG4gICAqICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJhbGVydC10ZXh0XCI+XG4gICAqICAgICAgICAgICAgICAgICAuLi5cbiAgICogICAgICAgICAgICA8L3NwYW4+XG4gICAqICAgICAgICA8L2Rpdj5cbiAgICogICAgPC9kaXY+XG4gICAqIDwvZGl2PlxuICAgKiBgYGBcbiAgICovXG4gIHByaXZhdGUgYW5ub3VuY2VBcmlhTGl2ZU1lc3NhZ2UoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmhpZGRlbiAmJiB0aGlzLmFsZXJ0VGV4dHMubGVuZ3RoKSB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gdGhpcy5hbGVydFRleHRzLm1hcChhbGVydFRleHQgPT4gYWxlcnRUZXh0Lm5hdGl2ZUVsZW1lbnQudGV4dENvbnRlbnQpLmpvaW4oJyAnKTtcbiAgICAgIC8vIERvbid0IGNhbGwgYW5ub3VuY2Ugd2hlbiB0aGVyZSBpcyBub3RoaW5nIHRvIHNheVxuICAgICAgaWYgKG1lc3NhZ2UpIHtcbiAgICAgICAgdGhpcy5hcmlhTGl2ZVNlcnZpY2UuYW5ub3VuY2UobWVzc2FnZSwgdGhpcy5hcmlhTGl2ZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfaGlkZGVuOiBib29sZWFuO1xuXG4gIHNldCBoaWRkZW4odmFsdWU6IGJvb2xlYW4pIHtcbiAgICBpZiAodmFsdWUgIT09IHRoaXMuX2hpZGRlbikge1xuICAgICAgdGhpcy5faGlkZGVuID0gdmFsdWU7XG4gICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGhpZGRlbigpIHtcbiAgICByZXR1cm4gdGhpcy5faGlkZGVuO1xuICB9XG5cbiAgY2xvc2UoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNsb3NhYmxlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX2Nsb3NlZCA9IHRydWU7XG4gICAgaWYgKHRoaXMubXVsdGlBbGVydFNlcnZpY2UpIHtcbiAgICAgIHRoaXMubXVsdGlBbGVydFNlcnZpY2UuY2xvc2UoKTtcbiAgICB9XG4gICAgdGhpcy5fY2xvc2VkQ2hhbmdlZC5lbWl0KHRydWUpO1xuICB9XG5cbiAgb3BlbigpOiB2b2lkIHtcbiAgICB0aGlzLl9jbG9zZWQgPSBmYWxzZTtcbiAgICB0aGlzLl9jbG9zZWRDaGFuZ2VkLmVtaXQoZmFsc2UpO1xuICB9XG59XG4iXX0=