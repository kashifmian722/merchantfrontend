import { __decorate, __param } from "tslib";
/*
 * Copyright (c) 2016-2020 VMware, Inc. All Rights Reserved.
 * This software is released under MIT license.
 * The full license information can be found in LICENSE in the root directory of this project.
 */
import { ChangeDetectorRef, ElementRef, Component, EventEmitter, Input, Optional, Output, AfterViewInit, ContentChildren, QueryList, OnInit, OnDestroy, } from '@angular/core';
// providers
import { AlertIconAndTypesService } from './providers/icon-and-types.service';
import { MultiAlertService } from './providers/multi-alert.service';
import { isBooleanAttributeSet } from '../../utils/component/is-boolean-attribute-set';
import { ClrCommonStringsService } from '../../utils/i18n/common-strings.service';
import { ClrAriaLiveService, ClrAriaLivePoliteness } from '../../utils/a11y/aria-live.service';
import { ClrAlertText } from './alert-text';
var ClrAlert = /** @class */ (function () {
    function ClrAlert(iconService, cdr, multiAlertService, commonStrings, ariaLiveService) {
        this.iconService = iconService;
        this.cdr = cdr;
        this.multiAlertService = multiAlertService;
        this.commonStrings = commonStrings;
        this.ariaLiveService = ariaLiveService;
        this.subscriptions = [];
        this.isSmall = false;
        this.closable = true;
        this.isAppLevel = false;
        // Aria
        this.clrCloseButtonAriaLabel = this.commonStrings.keys.alertCloseButtonAriaLabel;
        this._closed = false;
        this._closedChanged = new EventEmitter(false);
        /**
         * clrPolite is not used in the code. Is here just to provide
         * code complition and also mark component what type AriaLive
         * will be used.
         */
        /** @deprecated since 3.0, remove in 4.0 */
        this.polite = true;
    }
    ClrAlert.prototype.ngOnInit = function () {
        var _this = this;
        if (this.multiAlertService) {
            this.subscriptions.push(this.multiAlertService.changes.subscribe(function () {
                _this.hidden = _this.multiAlertService.currentAlert !== _this;
            }));
        }
    };
    ClrAlert.prototype.ngOnDestroy = function () {
        this.subscriptions.forEach(function (sub) { return sub.unsubscribe(); });
    };
    ClrAlert.prototype.ngAfterViewInit = function () {
        // Announce the first time the alert is render if it is not hidden
        this.announceAriaLiveMessage();
    };
    Object.defineProperty(ClrAlert.prototype, "alertType", {
        get: function () {
            return this.iconService.alertType;
        },
        set: function (val) {
            this.iconService.alertType = val;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ClrAlert.prototype, "ariaLive", {
        /**
         * There is an order on how the attributes will take effect.
         * Assertive, Off, Polite.
         *
         * Polite is default if non is passed.
         *
         * In the case of setting all of them to true. Assertive will be used.
         *
         */
        get: function () {
            if (isBooleanAttributeSet(this.assertive)) {
                return ClrAriaLivePoliteness.assertive;
            }
            if (isBooleanAttributeSet(this.off)) {
                return ClrAriaLivePoliteness.off;
            }
            return ClrAriaLivePoliteness.polite;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ClrAlert.prototype, "alertIconShape", {
        set: function (value) {
            this.iconService.alertIconShape = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ClrAlert.prototype, "alertClass", {
        get: function () {
            return this.iconService.iconInfoFromType(this.iconService.alertType).cssClass;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * This handle the find what content to be annonced withing the aria-live container
     * alerts that are hidden will be ignored.
     *
     * @remark
     * We depend on the ClrAlertText Directive to find and parse the alert messages.
     * Also this require the HTML markup for the alert to be
     * ```html
     * <div class="alert" role="alert">
     *    <div class="alert-items">
     *        <div class="alert-item static">
     *            <span class="alert-text">
     *                 ...
     *            </span>
     *        </div>
     *    </div>
     * </div>
     * ```
     */
    ClrAlert.prototype.announceAriaLiveMessage = function () {
        if (!this.hidden && this.alertTexts.length) {
            var message = this.alertTexts.map(function (alertText) { return alertText.nativeElement.textContent; }).join(' ');
            // Don't call announce when there is nothing to say
            if (message) {
                this.ariaLiveService.announce(message, this.ariaLive);
            }
        }
    };
    Object.defineProperty(ClrAlert.prototype, "hidden", {
        get: function () {
            return this._hidden;
        },
        set: function (value) {
            if (value !== this._hidden) {
                this._hidden = value;
                this.cdr.detectChanges();
            }
        },
        enumerable: true,
        configurable: true
    });
    ClrAlert.prototype.close = function () {
        if (!this.closable) {
            return;
        }
        this._closed = true;
        if (this.multiAlertService) {
            this.multiAlertService.close();
        }
        this._closedChanged.emit(true);
    };
    ClrAlert.prototype.open = function () {
        this._closed = false;
        this._closedChanged.emit(false);
    };
    ClrAlert.ctorParameters = function () { return [
        { type: AlertIconAndTypesService },
        { type: ChangeDetectorRef },
        { type: MultiAlertService, decorators: [{ type: Optional }] },
        { type: ClrCommonStringsService },
        { type: ClrAriaLiveService }
    ]; };
    __decorate([
        Input('clrAlertSizeSmall')
    ], ClrAlert.prototype, "isSmall", void 0);
    __decorate([
        Input('clrAlertClosable')
    ], ClrAlert.prototype, "closable", void 0);
    __decorate([
        Input('clrAlertAppLevel')
    ], ClrAlert.prototype, "isAppLevel", void 0);
    __decorate([
        Input()
    ], ClrAlert.prototype, "clrCloseButtonAriaLabel", void 0);
    __decorate([
        Input('clrAlertClosed')
    ], ClrAlert.prototype, "_closed", void 0);
    __decorate([
        Output('clrAlertClosedChange')
    ], ClrAlert.prototype, "_closedChanged", void 0);
    __decorate([
        Input('clrAlertType')
    ], ClrAlert.prototype, "alertType", null);
    __decorate([
        Input('clrPolite')
    ], ClrAlert.prototype, "polite", void 0);
    __decorate([
        Input('clrAssertive')
    ], ClrAlert.prototype, "assertive", void 0);
    __decorate([
        Input('clrOff')
    ], ClrAlert.prototype, "off", void 0);
    __decorate([
        Input('clrAlertIcon')
    ], ClrAlert.prototype, "alertIconShape", null);
    __decorate([
        ContentChildren(ClrAlertText, { descendants: true, read: ElementRef })
    ], ClrAlert.prototype, "alertTexts", void 0);
    ClrAlert = __decorate([
        Component({
            selector: 'clr-alert',
            providers: [AlertIconAndTypesService, ClrAriaLiveService],
            template: "<!--\n  ~ Copyright (c) 2016-2020 VMware, Inc. All Rights Reserved.\n  ~ This software is released under MIT license.\n  ~ The full license information can be found in LICENSE in the root directory of this project.\n  -->\n\n<div\n    *ngIf=\"!_closed\"\n    class=\"alert\"\n    [ngClass]=\"alertClass\"\n    [class.alert-hidden]=\"hidden\"\n    [class.alert-sm]=\"isSmall\"\n    [class.alert-app-level]=\"isAppLevel\">\n    <div class=\"alert-items\">\n        <ng-content></ng-content>\n    </div>\n    <button\n        type=\"button\"\n        class=\"close\"\n        *ngIf=\"closable\"\n        (click)=\"close()\"\n        [attr.aria-label]=\"clrCloseButtonAriaLabel\"\n        >\n        <clr-icon shape=\"close\"></clr-icon>\n    </button>\n</div>\n",
            styles: [':host { display: block; }']
        }),
        __param(2, Optional())
    ], ClrAlert);
    return ClrAlert;
}());
export { ClrAlert };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWxlcnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AY2xyL2FuZ3VsYXIvIiwic291cmNlcyI6WyJlbXBoYXNpcy9hbGVydC9hbGVydC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRztBQUNILE9BQU8sRUFDTCxpQkFBaUIsRUFDakIsVUFBVSxFQUNWLFNBQVMsRUFDVCxZQUFZLEVBQ1osS0FBSyxFQUNMLFFBQVEsRUFDUixNQUFNLEVBQ04sYUFBYSxFQUNiLGVBQWUsRUFDZixTQUFTLEVBQ1QsTUFBTSxFQUNOLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUV2QixZQUFZO0FBQ1osT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDOUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDcEUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sZ0RBQWdELENBQUM7QUFDdkYsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFDbEYsT0FBTyxFQUFFLGtCQUFrQixFQUFFLHFCQUFxQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDL0YsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGNBQWMsQ0FBQztBQVM1QztJQUdFLGtCQUNVLFdBQXFDLEVBQ3JDLEdBQXNCLEVBQ1YsaUJBQW9DLEVBQ2hELGFBQXNDLEVBQ3RDLGVBQW1DO1FBSm5DLGdCQUFXLEdBQVgsV0FBVyxDQUEwQjtRQUNyQyxRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQUNWLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDaEQsa0JBQWEsR0FBYixhQUFhLENBQXlCO1FBQ3RDLG9CQUFlLEdBQWYsZUFBZSxDQUFvQjtRQVByQyxrQkFBYSxHQUFtQixFQUFFLENBQUM7UUE2QmYsWUFBTyxHQUFZLEtBQUssQ0FBQztRQUMxQixhQUFRLEdBQVksSUFBSSxDQUFDO1FBQ3pCLGVBQVUsR0FBWSxLQUFLLENBQUM7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SyxDQUFDLFFBQVEsQ0FBQzt5Q0FBYztJQXFCOUI7UUFEQyxLQUFLLENBQUMsY0FBYyxDQUFDO2tEQUdyQjtJQU9EO1FBREMsZUFBZSxDQUFDLFlBQVksRUFBRSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxDQUFDO2dEQUNyQztJQXpGdkIsUUFBUTtRQU5wQixTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsV0FBVztZQUNyQixTQUFTLEVBQUUsQ0FBQyx3QkFBd0IsRUFBRSxrQkFBa0IsQ0FBQztZQUN6RCxrd0JBQTJCO3FCQUNsQiwyQkFBMkI7U0FDckMsQ0FBQztRQU9HLFdBQUEsUUFBUSxFQUFFLENBQUE7T0FORixRQUFRLENBbUpwQjtJQUFELGVBQUM7Q0FBQSxBQW5KRCxJQW1KQztTQW5KWSxRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoYykgMjAxNi0yMDIwIFZNd2FyZSwgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogVGhpcyBzb2Z0d2FyZSBpcyByZWxlYXNlZCB1bmRlciBNSVQgbGljZW5zZS5cbiAqIFRoZSBmdWxsIGxpY2Vuc2UgaW5mb3JtYXRpb24gY2FuIGJlIGZvdW5kIGluIExJQ0VOU0UgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgcHJvamVjdC5cbiAqL1xuaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIEVsZW1lbnRSZWYsXG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT3B0aW9uYWwsXG4gIE91dHB1dCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBRdWVyeUxpc3QsXG4gIE9uSW5pdCxcbiAgT25EZXN0cm95LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuLy8gcHJvdmlkZXJzXG5pbXBvcnQgeyBBbGVydEljb25BbmRUeXBlc1NlcnZpY2UgfSBmcm9tICcuL3Byb3ZpZGVycy9pY29uLWFuZC10eXBlcy5zZXJ2aWNlJztcbmltcG9ydCB7IE11bHRpQWxlcnRTZXJ2aWNlIH0gZnJvbSAnLi9wcm92aWRlcnMvbXVsdGktYWxlcnQuc2VydmljZSc7XG5pbXBvcnQgeyBpc0Jvb2xlYW5BdHRyaWJ1dGVTZXQgfSBmcm9tICcuLi8uLi91dGlscy9jb21wb25lbnQvaXMtYm9vbGVhbi1hdHRyaWJ1dGUtc2V0JztcbmltcG9ydCB7IENsckNvbW1vblN0cmluZ3NTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vdXRpbHMvaTE4bi9jb21tb24tc3RyaW5ncy5zZXJ2aWNlJztcbmltcG9ydCB7IENsckFyaWFMaXZlU2VydmljZSwgQ2xyQXJpYUxpdmVQb2xpdGVuZXNzIH0gZnJvbSAnLi4vLi4vdXRpbHMvYTExeS9hcmlhLWxpdmUuc2VydmljZSc7XG5pbXBvcnQgeyBDbHJBbGVydFRleHQgfSBmcm9tICcuL2FsZXJ0LXRleHQnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2Nsci1hbGVydCcsXG4gIHByb3ZpZGVyczogW0FsZXJ0SWNvbkFuZFR5cGVzU2VydmljZSwgQ2xyQXJpYUxpdmVTZXJ2aWNlXSxcbiAgdGVtcGxhdGVVcmw6ICcuL2FsZXJ0Lmh0bWwnLFxuICBzdHlsZXM6IFsnOmhvc3QgeyBkaXNwbGF5OiBibG9jazsgfSddLFxufSlcbmV4cG9ydCBjbGFzcyBDbHJBbGVydCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBBZnRlclZpZXdJbml0IHtcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb25zOiBTdWJzY3JpcHRpb25bXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgaWNvblNlcnZpY2U6IEFsZXJ0SWNvbkFuZFR5cGVzU2VydmljZSxcbiAgICBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBtdWx0aUFsZXJ0U2VydmljZTogTXVsdGlBbGVydFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBjb21tb25TdHJpbmdzOiBDbHJDb21tb25TdHJpbmdzU2VydmljZSxcbiAgICBwcml2YXRlIGFyaWFMaXZlU2VydmljZTogQ2xyQXJpYUxpdmVTZXJ2aWNlXG4gICkge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICBpZiAodGhpcy5tdWx0aUFsZXJ0U2VydmljZSkge1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goXG4gICAgICAgIHRoaXMubXVsdGlBbGVydFNlcnZpY2UuY2hhbmdlcy5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuaGlkZGVuID0gdGhpcy5tdWx0aUFsZXJ0U2VydmljZS5jdXJyZW50QWxlcnQgIT09IHRoaXM7XG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5mb3JFYWNoKHN1YiA9PiBzdWIudW5zdWJzY3JpYmUoKSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgLy8gQW5ub3VuY2UgdGhlIGZpcnN0IHRpbWUgdGhlIGFsZXJ0IGlzIHJlbmRlciBpZiBpdCBpcyBub3QgaGlkZGVuXG4gICAgdGhpcy5hbm5vdW5jZUFyaWFMaXZlTWVzc2FnZSgpO1xuICB9XG5cbiAgQElucHV0KCdjbHJBbGVydFNpemVTbWFsbCcpIGlzU21hbGw6IGJvb2xlYW4gPSBmYWxzZTtcbiAgQElucHV0KCdjbHJBbGVydENsb3NhYmxlJykgY2xvc2FibGU6IGJvb2xlYW4gPSB0cnVlO1xuICBASW5wdXQoJ2NsckFsZXJ0QXBwTGV2ZWwnKSBpc0FwcExldmVsOiBib29sZWFuID0gZmFsc2U7XG5cbiAgLy8gQXJpYVxuICBASW5wdXQoKSBjbHJDbG9zZUJ1dHRvbkFyaWFMYWJlbDogc3RyaW5nID0gdGhpcy5jb21tb25TdHJpbmdzLmtleXMuYWxlcnRDbG9zZUJ1dHRvbkFyaWFMYWJlbDtcblxuICBASW5wdXQoJ2NsckFsZXJ0Q2xvc2VkJykgX2Nsb3NlZDogYm9vbGVhbiA9IGZhbHNlO1xuICBAT3V0cHV0KCdjbHJBbGVydENsb3NlZENoYW5nZScpIF9jbG9zZWRDaGFuZ2VkOiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4gPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KGZhbHNlKTtcblxuICBASW5wdXQoJ2NsckFsZXJ0VHlwZScpXG4gIHNldCBhbGVydFR5cGUodmFsOiBzdHJpbmcpIHtcbiAgICB0aGlzLmljb25TZXJ2aWNlLmFsZXJ0VHlwZSA9IHZhbDtcbiAgfVxuXG4gIGdldCBhbGVydFR5cGUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pY29uU2VydmljZS5hbGVydFR5cGU7XG4gIH1cblxuICAvKipcbiAgICogY2xyUG9saXRlIGlzIG5vdCB1c2VkIGluIHRoZSBjb2RlLiBJcyBoZXJlIGp1c3QgdG8gcHJvdmlkZVxuICAgKiBjb2RlIGNvbXBsaXRpb24gYW5kIGFsc28gbWFyayBjb21wb25lbnQgd2hhdCB0eXBlIEFyaWFMaXZlXG4gICAqIHdpbGwgYmUgdXNlZC5cbiAgICovXG4gIC8qKiBAZGVwcmVjYXRlZCBzaW5jZSAzLjAsIHJlbW92ZSBpbiA0LjAgKi9cbiAgQElucHV0KCdjbHJQb2xpdGUnKSBwb2xpdGU6IGJvb2xlYW4gPSB0cnVlO1xuICAvKiogQGRlcHJlY2F0ZWQgc2luY2UgMy4wLCByZW1vdmUgaW4gNC4wICovXG4gIEBJbnB1dCgnY2xyQXNzZXJ0aXZlJykgYXNzZXJ0aXZlOiBib29sZWFuO1xuICAvKiogQGRlcHJlY2F0ZWQgc2luY2UgMy4wLCByZW1vdmUgaW4gNC4wICovXG4gIEBJbnB1dCgnY2xyT2ZmJykgb2ZmOiBib29sZWFuO1xuICAvKipcbiAgICogVGhlcmUgaXMgYW4gb3JkZXIgb24gaG93IHRoZSBhdHRyaWJ1dGVzIHdpbGwgdGFrZSBlZmZlY3QuXG4gICAqIEFzc2VydGl2ZSwgT2ZmLCBQb2xpdGUuXG4gICAqXG4gICAqIFBvbGl0ZSBpcyBkZWZhdWx0IGlmIG5vbiBpcyBwYXNzZWQuXG4gICAqXG4gICAqIEluIHRoZSBjYXNlIG9mIHNldHRpbmcgYWxsIG9mIHRoZW0gdG8gdHJ1ZS4gQXNzZXJ0aXZlIHdpbGwgYmUgdXNlZC5cbiAgICpcbiAgICovXG4gIGdldCBhcmlhTGl2ZSgpOiBDbHJBcmlhTGl2ZVBvbGl0ZW5lc3Mge1xuICAgIGlmIChpc0Jvb2xlYW5BdHRyaWJ1dGVTZXQodGhpcy5hc3NlcnRpdmUpKSB7XG4gICAgICByZXR1cm4gQ2xyQXJpYUxpdmVQb2xpdGVuZXNzLmFzc2VydGl2ZTtcbiAgICB9XG4gICAgaWYgKGlzQm9vbGVhbkF0dHJpYnV0ZVNldCh0aGlzLm9mZikpIHtcbiAgICAgIHJldHVybiBDbHJBcmlhTGl2ZVBvbGl0ZW5lc3Mub2ZmO1xuICAgIH1cbiAgICByZXR1cm4gQ2xyQXJpYUxpdmVQb2xpdGVuZXNzLnBvbGl0ZTtcbiAgfVxuXG4gIEBJbnB1dCgnY2xyQWxlcnRJY29uJylcbiAgc2V0IGFsZXJ0SWNvblNoYXBlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLmljb25TZXJ2aWNlLmFsZXJ0SWNvblNoYXBlID0gdmFsdWU7XG4gIH1cblxuICBnZXQgYWxlcnRDbGFzcygpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmljb25TZXJ2aWNlLmljb25JbmZvRnJvbVR5cGUodGhpcy5pY29uU2VydmljZS5hbGVydFR5cGUpLmNzc0NsYXNzO1xuICB9XG5cbiAgQENvbnRlbnRDaGlsZHJlbihDbHJBbGVydFRleHQsIHsgZGVzY2VuZGFudHM6IHRydWUsIHJlYWQ6IEVsZW1lbnRSZWYgfSlcbiAgYWxlcnRUZXh0czogUXVlcnlMaXN0PEVsZW1lbnRSZWY+O1xuICAvKipcbiAgICogVGhpcyBoYW5kbGUgdGhlIGZpbmQgd2hhdCBjb250ZW50IHRvIGJlIGFubm9uY2VkIHdpdGhpbmcgdGhlIGFyaWEtbGl2ZSBjb250YWluZXJcbiAgICogYWxlcnRzIHRoYXQgYXJlIGhpZGRlbiB3aWxsIGJlIGlnbm9yZWQuXG4gICAqXG4gICAqIEByZW1hcmtcbiAgICogV2UgZGVwZW5kIG9uIHRoZSBDbHJBbGVydFRleHQgRGlyZWN0aXZlIHRvIGZpbmQgYW5kIHBhcnNlIHRoZSBhbGVydCBtZXNzYWdlcy5cbiAgICogQWxzbyB0aGlzIHJlcXVpcmUgdGhlIEhUTUwgbWFya3VwIGZvciB0aGUgYWxlcnQgdG8gYmVcbiAgICogYGBgaHRtbFxuICAgKiA8ZGl2IGNsYXNzPVwiYWxlcnRcIiByb2xlPVwiYWxlcnRcIj5cbiAgICogICAgPGRpdiBjbGFzcz1cImFsZXJ0LWl0ZW1zXCI+XG4gICAqICAgICAgICA8ZGl2IGNsYXNzPVwiYWxlcnQtaXRlbSBzdGF0aWNcIj5cbiAgICogICAgICAgICAgICA8c3BhbiBjbGFzcz1cImFsZXJ0LXRleHRcIj5cbiAgICogICAgICAgICAgICAgICAgIC4uLlxuICAgKiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICogICAgICAgIDwvZGl2PlxuICAgKiAgICA8L2Rpdj5cbiAgICogPC9kaXY+XG4gICAqIGBgYFxuICAgKi9cbiAgcHJpdmF0ZSBhbm5vdW5jZUFyaWFMaXZlTWVzc2FnZSgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaGlkZGVuICYmIHRoaXMuYWxlcnRUZXh0cy5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0aGlzLmFsZXJ0VGV4dHMubWFwKGFsZXJ0VGV4dCA9PiBhbGVydFRleHQubmF0aXZlRWxlbWVudC50ZXh0Q29udGVudCkuam9pbignICcpO1xuICAgICAgLy8gRG9uJ3QgY2FsbCBhbm5vdW5jZSB3aGVuIHRoZXJlIGlzIG5vdGhpbmcgdG8gc2F5XG4gICAgICBpZiAobWVzc2FnZSkge1xuICAgICAgICB0aGlzLmFyaWFMaXZlU2VydmljZS5hbm5vdW5jZShtZXNzYWdlLCB0aGlzLmFyaWFMaXZlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9oaWRkZW46IGJvb2xlYW47XG5cbiAgc2V0IGhpZGRlbih2YWx1ZTogYm9vbGVhbikge1xuICAgIGlmICh2YWx1ZSAhPT0gdGhpcy5faGlkZGVuKSB7XG4gICAgICB0aGlzLl9oaWRkZW4gPSB2YWx1ZTtcbiAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcbiAgICB9XG4gIH1cblxuICBnZXQgaGlkZGVuKCkge1xuICAgIHJldHVybiB0aGlzLl9oaWRkZW47XG4gIH1cblxuICBjbG9zZSgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuY2xvc2FibGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5fY2xvc2VkID0gdHJ1ZTtcbiAgICBpZiAodGhpcy5tdWx0aUFsZXJ0U2VydmljZSkge1xuICAgICAgdGhpcy5tdWx0aUFsZXJ0U2VydmljZS5jbG9zZSgpO1xuICAgIH1cbiAgICB0aGlzLl9jbG9zZWRDaGFuZ2VkLmVtaXQodHJ1ZSk7XG4gIH1cblxuICBvcGVuKCk6IHZvaWQge1xuICAgIHRoaXMuX2Nsb3NlZCA9IGZhbHNlO1xuICAgIHRoaXMuX2Nsb3NlZENoYW5nZWQuZW1pdChmYWxzZSk7XG4gIH1cbn1cbiJdfQ==